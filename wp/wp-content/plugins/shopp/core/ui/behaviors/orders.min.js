jQuery(document).ready(function(e){e.template("shipment-ui",e("#shipment-ui")),e.template("shipnotice-ui",e("#shipnotice-ui")),e.template("refund-ui",e("#refund-ui")),e.template("address-ui",e("#address-editor")),e.template("customer-ui",e("#customer-editor")),e.template("customer-select",e("#customer-selector")),e.template("change-customer",e("#change-customer-ui"));var t=e("#order-manage"),n=t.find("div.manager-ui"),i="";e.each(carriers,function(e,t){i+='<option value="'+e+'">'+t[0]+"</option>"}),e("#shipnote-button").click(function(t){t.preventDefault();var c=e(this).hide(),r=[],o=e.tmpl("shipnotice-ui",{shipmentnum:2}),s=o.find("ol li"),a=function(){s.find("span.number").text(r.length+1+".")};o.find("#addship-button").click(function(t){t.preventDefault();var n=r.length,c=e.tmpl("shipment-ui",{id:n,num:n+1}),o=c.find("select").html(i),d=(c.find(".tracking").change(function(){var t=e(this).val().toUpperCase().replace(/[^A-Z0-9]/,"");e.each(carriers,function(e,n){if(null!=t.match(new RegExp(n[1].substr(1,n[1].length-2))))return o.val(e),!1})}),c.find("button.delete").click(function(e){e.preventDefault(),c.remove(),r.splice(n,1),a()}).hide());n>0&&c.hover(function(){d.show()},function(){d.fadeOut("fast")}),r.push(c.insertBefore(s)),a()}).click(),o.find("#cancel-ship").click(function(e){e.preventDefault(),o.fadeRemove("fast",function(){c.show()})});n.empty().append(o)}),e("#cancel-order, #refund-button").click(function(t){t.preventDefault();var i=e(this).attr("disabled",!0),c="refund-button"==i.attr("id")?{action:"refund",title:$om.ro,cancel:$om.cancel,send:$om.stg,process:$om.pr,reason:$om.rr}:{action:"cancel",title:$om.co,cancel:$om.dnc,send:$om.stg,process:$om.co,reason:$om.rc,disable_amount:' disabled="disabled"'},r=e.tmpl("refund-ui",c);r.find("#cancel-refund").click(function(e){e.preventDefault(),r.fadeRemove("fast",function(){i.show()})});n.empty().append(r)}),e("#print-button").click(function(t){t.preventDefault();var n=e("#print-receipt").get(0),i=n.contentWindow,c=-1!==navigator.userAgent.indexOf("Trident"),r=-1!==navigator.userAgent.indexOf("Presto");if(c||r){var o=window.open(i.location.href+"&print=auto");e(o).load(function(){o.close()})}else i.focus(),i.print();return!1});editaddress=function(t){var n=e(this),i=address[t],c=e.tmpl("address-ui",i),r=e("#"+t+"-address-editor"),o=e("#order-"+t+" .display");c.find("#cancel-edit-address").click(function(e){e.preventDefault(),c.fadeRemove("fast",function(){n.show(),o.show()})});c.find("#"+t+"-state-menu").html(i.statemenu),c.find("#"+t+"-country").html(i.countrymenu).upstate(),o.hide(),r.hide().empty().append(c).slideDown("fast")},billaddrctrls=e("#edit-billing-address, #order-billing address").click(function(e){return e.preventDefault(),editaddress("billing"),!1}),billaddrctrls=e("#edit-shipping-address, #order-shipto address").click(function(e){return e.preventDefault(),editaddress("shipping"),!1}),editcustomer=e("#edit-customer").click(function(t){t.preventDefault();var n=e(this),i=e.tmpl("customer-ui",customer),c=e("#customer-editor-form"),r=e("#order-contact .display"),o=(e("#order-contact .inside"),function(e){e.preventDefault(),i.fadeRemove("fast",function(){n.show(),r.show()})});i.find("#change-customer").click(function(t){t.preventDefault(),c.hide(),i=e.tmpl("change-customer");var n=e("#change-customer-editor").empty().append(i).slideDown("fast"),r=n.find("#customer-search-results").hide(),s=(n.find(".change-button").hide(),e("#cancel-change-customer").hide());i.find("#cancel-edit-customer").click(o),e("#customer-search").submit(function(t){e("#change-customer").hide(),s.show().click(o),r.show()})}),i.find("#cancel-edit-customer").click(o);return r.hide(),c.hide().empty().append(i).slideDown("fast"),!1})});